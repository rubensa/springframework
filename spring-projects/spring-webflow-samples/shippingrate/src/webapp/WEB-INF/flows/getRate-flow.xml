<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE flow PUBLIC "-//SPRING//DTD WEBFLOW//EN"
	"http://www.springframework.org/dtd/spring-webflow-1.0.dtd">

<flow start-state="selectCustomerType">

	<view-state id="selectCustomerType" view="selectCustomer">
        <entry-actions>
			<action bean="formAction" method="setupForm"/>
		</entry-actions>
        <transition on="submit" to="selectSender">
			<action bean="formAction" method="bindAndValidate"/>
        </transition>
	</view-state>
	
	<view-state id="selectSender" view="selectSender">
		<entry-actions>
            <action bean="rateService" method="getCountries" resultName="countries"/>
		</entry-actions>
        <transition on="submit" to="selectReceiver">
			<action bean="formAction" method="bindAndValidate">
				<property name="validatorMethod" value="validateSender"/>
			</action>
        </transition>
	</view-state>
	
	<view-state id="selectReceiver" view="selectReceiver">
		<entry-actions>
            <action bean="rateService" method="getCountries" resultName="countries"/>
		</entry-actions>
        <transition on="submit" to="selectPackageDetails">
			<action bean="formAction" method="bindAndValidate">
				<property name="validatorMethod" value="validateReceiver"/>
			</action>
        </transition>
	</view-state>
	
	<view-state id="selectPackageDetails" view="selectPackageDetails">
		<entry-actions>
            <action bean="rateService" method="getPackageTypes" resultName="packageTypes"/>
		</entry-actions>
        <transition on="submit" to="findRate">
			<action bean="formAction" method="bindAndValidate">
				<property name="validatorMethod" value="validatePackageDetails"/>
			</action>
        </transition>
	</view-state>
	
	<action-state id="findRate">
		<action bean="rateService" method="getRate(${flowScope.rateCriteria})" resultName="rate"/>
		<transition on="success" to="showRate"/>
	</action-state>
	
	<end-state id="showRate" view="showRate"/>
	
</flow>