<?xml version="1.0" encoding="UTF-8"?>
<!--
	- DispatcherServlet application context for PetClinic's web tier.
-->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd">

	<!--  
		Activates various annotations to be detected in bean classes: Spring's 
		@Required and @Autowired, as well as JSR 250's @PostConstruct, 
		@PreDestroy and @Resource (if available) and JPA's @PersistenceContext 
		and @PersistenceUnit (if available). 
	-->
	<context:annotation-config />

	<!-- ========================= MESSAGE SOURCE DEFINITION ========================= -->

	<!--
		- Message source for this context, loaded from localized "messages_xx" files.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
	-->
	<bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource"
		p:basename="messages" />


	<!-- ========================= MAPPING DEFINITIONS ========================= -->

	<!--
		- All handlers within this application provide @RequestMapping annotations.
		- Handler-mapping (and method name resolution in the case of ClinicController)
		- is driven by those annotations. This behavior is enabled by default with Java 5+.
	-->

	<!--
		- This bean resolves specific types of exception to corresponding error views.
		- The default behaviour of DispatcherServlet is to propagate all exceptions to the
		- servlet container: This will happen here with all other types of exception.
	-->
	<bean id="exceptionResolver" class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
		<property name="exceptionMappings">
			<props>
				<prop key="org.springframework.dao.DataAccessException">dataAccessFailure</prop>
				<prop key="org.springframework.transaction.TransactionException">dataAccessFailure</prop>
			</props>
		</property>
	</bean>

	<!--
		- This bean resolves default view names for controllers that do not explicitly
		- specify a view name in their return ModelAndView (see ClinicController).
		- This translator takes the request URL and extracts a view name from it: e.g.
		- "/welcome.html" -> "welcome", plus configured "View" suffix -> "welcomeView".
	-->
	<bean id="viewNameTranslator" class="org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator"
		p:suffix="View" />

	<!--
		- This bean provides explicit View mappings in a resource bundle instead of the
		- default InternalResourceViewResolver. It fetches the view mappings from
		- localized "views_xx" classpath files, i.e. "/WEB-INF/classes/views.properties"
		- or "/WEB-INF/classes/views_de.properties".
		-
		- Symbolic view names returned by Controllers will be resolved by this bean
		- using the respective properties file, which defines arbitrary mappings between
		- view names and resources.
	-->
	<bean id="viewResolver" class="org.springframework.web.servlet.view.ResourceBundleViewResolver"
		p:basename="views" />


	<!-- ========================= CONTROLLER DEFINITIONS ========================= -->

	<!--
		- This controller is a POJO labeled with the @Controller annotation. It provides multiple
		- handler methods (each marked with @RequestMapping) to manage general View rendering.
	-->
	<bean id="clinicController" class="org.springframework.samples.petclinic.web.ClinicController" />

	<!--
		- Validator for owner forms, implementing Spring's Validator interface.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
	-->
	<bean id="ownerValidator" class="org.springframework.samples.petclinic.validation.OwnerValidator" />

	<!--
		- Validator for pet forms, implementing Spring's Validator interface.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
	-->
	<bean id="petValidator" class="org.springframework.samples.petclinic.validation.PetValidator" />

	<!--
		- Validator for visit forms, implementing Spring's Validator interface.
		- Could also reside in the root application context, as it is generic,
		- but is currently just used within PetClinic's web tier.
	-->
	<bean id="visitValidator" class="org.springframework.samples.petclinic.validation.VisitValidator" />

	<!--
		- This bean is a SimpleFormController that manages the findOwner use case.
		- It uses the "findOwnersValidator" and "clinic" beans.
	-->
	<bean id="findOwnersForm" class="org.springframework.samples.petclinic.web.FindOwnersForm"
		p:formView="findOwnersForm" p:selectView="selectOwnerView" p:successView="ownerRedirect" />

	<!--
		- This bean is a SimpleFormController that manages the addOwner use case.
		- It uses the "ownerValidator" and "clinic" beans.
	-->
	<bean id="addOwnerForm" class="org.springframework.samples.petclinic.web.AddOwnerForm"
		p:formView="ownerForm" p:successView="ownerRedirect" p:validator-ref="ownerValidator" />

	<!--
		- This bean is a SimpleFormController that manages the editOwner use case.
		- It uses the "ownerValidator" and "clinic" beans.
	-->
	<bean id="editOwnerForm" class="org.springframework.samples.petclinic.web.EditOwnerForm"
		p:formView="ownerForm" p:successView="ownerRedirect" p:validator-ref="ownerValidator" />

	<!--
		- This bean is a SimpleFormController that manages the addPet use case.
		- It uses the "petValidator" and "clinic" beans.
	-->
	<bean id="addPetForm" class="org.springframework.samples.petclinic.web.AddPetForm"
		p:formView="petForm" p:successView="ownerRedirect" p:validator-ref="petValidator" />

	<!--
		- This bean is a SimpleFormController that manages the editPet use case.
		- It uses the "petValidator" and "clinic" beans.
	-->
	<bean id="editPetForm" class="org.springframework.samples.petclinic.web.EditPetForm"
		p:formView="petForm" p:successView="ownerRedirect" p:validator-ref="petValidator" />

	<!--
		- This bean is a SimpleFormController that manages the addVisit use case.
		- It uses the "visitValidator" and "clinic" beans.
	-->
	<bean id="addVisitForm" class="org.springframework.samples.petclinic.web.AddVisitForm"
		p:formView="visitForm" p:successView="ownerRedirect" p:validator-ref="visitValidator" />


</beans>
